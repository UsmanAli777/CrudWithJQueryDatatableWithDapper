@{
    ViewBag.Title = "Employee List";
}

<a class="btn btn-success" style="margin-bottom: 10px" data-toggle="modal" data-target="#exampleModalCenter" data-url="/Employee/AddOrEdit" data-type='add'> Add New</a>

<table id="employeeTable" class="ui celled table" width="100%">
    <thead>
        <tr>
            <th>Name</th>
            <th>Position</th>
            <th>Office</th>
            <th>Age</th>
            <th>Salary</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tfoot>
        <tr>
            <th>Name</th>
            <th>Position</th>
            <th>Office</th>
            <th>Age</th>
            <th>Salary</th>
            <th>Actions</th>
        </tr>
    </tfoot>
</table>
<link href="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.8.8/semantic.min.css" rel="stylesheet" />
<link href="https://cdn.datatables.net/1.12.1/css/dataTables.semanticui.min.css" rel="stylesheet" />

@section scripts{
    @*<script src="~/Scripts/jquery.dataTables.min.js"></script>*@
    <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="shaankds">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.12.1/js/dataTables.semanticui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fomantic-ui/2.8.8/semantic.min.js"></script>

    <script src="~/Scripts/dataTables.buttons.min.js"></script>
    <script src="~/Scripts/jszip.min.js"></script>
    <script src="~/Scripts/buttons.flash.min.js"></script>
    <script src="~/Scripts/pdfmake.min.js"></script>
    <script src="~/Scripts/buttons.html5.min.js"></script>
    <script src="~/Scripts/jquery.validate.min.js"></script>

    <script>
        var dataTable;
        $(document).ready(function () {
            dataTable = $("#employeeTable").DataTable({
                "dom": "Bflrtip",

                "ajax": {
                    "url": "/Employee/GetList",
                    "type": "POST",
                    "datatype":"json"
                },
                //"processing":true,
                //"serverSide": true,
                //"info": true,
                //"filter": true,
                //"orderMulti": false,
                "columns": [
                    { "data": "Name","name":"Name" },
                    { "data": "Position", "name": "Position" },
                    { "data": "Office", "name": "Office" },
                    { "data": "Age", "name": "Age" },
                    { "data": "Salary", "name": "Salary" },
                    {
                        "data": "EmployeeId", "render": function (data) {
                            return "<a class='btn btn-default btn-sm' data-url='/Employee/AddOrEdit?id=" + data +"' data-type='edit' data-toggle='modal' data-target='#exampleModalCenter' > Edit</a> <a class='btn btn-danger btn-sm' onclick =Delete("+ data +") >Delete</a>"
                        },
                        //"orderable": true,
                        //"searchable" : false,
                        "width": "150px"
                    }
                ],
                "serverSide": true,
                "order": [0, "asc"],
                "processing": true,

                "language": {
                    "processing": "Processing... Please wait ",
                    "emptyTable": "No data found, Please click on <b>Add New</b> button"
                }

            });
        });

        $('#exampleModalCenter').on('shown.bs.modal', function (event) {
            //$('#shaankds').html('<img src="~/images/200.gif" />');
            $('#shaankds').html('<img src="/images/200.gif" />');
            var url = '';
            url = event.relatedTarget.getAttribute('data-url');
            $.get(url)
                .done(function (response) {
                    $('#shaankds').html(response);
                    //$.dataTable.draw();
                });
        });

        //debugger;
        //if (event.response) {
        //    Swal.fire({
        //        position: 'top-end',
        //        icon: 'success',
        //        title: 'Your work has been saved',
        //        showConfirmButton: false,
        //        timer: 1500
        //    });
        //    dataTable.reload();
        //}
        //debugger

        function Delete(id) {
            const swalWithBootstrapButtons = Swal.mixin({
                customClass: {
                    confirmButton: 'btn btn-success',
                    cancelButton: 'btn btn-danger'
                },
                buttonsStyling: false
            });
            swalWithBootstrapButtons.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'No, cancel!',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    {
                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("Delete","Employee")/' + id,
                            success: function (data) {
                                dataTable.ajax.reload();
                            }
                        });
                    }
                    swalWithBootstrapButtons.fire(
                        'Deleted!',
                        'Your file has been deleted.',
                        'success'
                    )
                } else if (result.dismiss === Swal.DismissReason.cancel) {
                    swalWithBootstrapButtons.fire(
                        'Cancelled',
                        'Your imaginary file is safe :)',
                        'error'
                    )
                }
            });

        }
    </script>

}